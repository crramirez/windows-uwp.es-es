---
author: drewbatgit
ms.assetid: F28162D4-AACC-4EE0-B243-5878F870F87F
description: Controlar las indicaciones de metadatos admitidos por el sistema durante la reproducción de contenido multimedia
title: Indicaciones de metadatos temporizados admitidos por el sistema
ms.author: drewbat
ms.date: 04/18/2017
ms.topic: article
keywords: windows 10, uwp, metadata, metadatos, cue, indicación, speech, voz, chapter, capítulo
ms.localizationpriority: medium
ms.openlocfilehash: 1e97c913764db24c68ce7becdba0fc283e1a3b73
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/03/2018
ms.locfileid: "5990805"
---
# <a name="system-supported-timed-metadata-cues"></a>Indicaciones de metadatos temporizados admitidos por el sistema
En este artículo se describe cómo sacar provecho de los diversos formatos de metadatos temporizados que pueden estar integrados en archivos o secuencias multimedia. Las aplicaciones para UWP pueden registrarse en los eventos que genera la canalización multimedia durante la reproducción cada vez que se encuentren estas indicaciones de metadatos. Con la clase [**DataCue**](https://docs.microsoft.com/uwp/api/Windows.Media.Core.DataCue), las aplicaciones pueden implementar sus propias indicaciones de metadatos personalizados, pero en este artículo nos centramos en varios estándares de metadatos que la canalización multimedia detecta automáticamente, por ejemplo:

* Subtítulos basados en imagen en formato VobSub
* Indicaciones de voz, como límites de palabras, límites de oración y marcadores de Lenguaje de marcado de síntesis de voz (SSML)
* Indicaciones de capítulo
* Comentarios M3U extendidos
* Etiquetas ID3
* Cuadros mp4 emsg fragmentados


En este artículo se amplían los conceptos presentados en el artículo [Elementos multimedia, listas de reproducción y pistas](media-playback-with-mediasource.md), que incluye los conceptos básicos de trabajar con las clases [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource), [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) y [**TimedMetadataTrack**](https://msdn.microsoft.com/library/windows/apps/dn956580), así como instrucciones generales sobre el uso de metadatos temporizados en la aplicación.

Los pasos básicos de implementación son los mismos para todos los distintos tipos de metadatos temporizados que se describen en este artículo:

1. Crea una clase [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) y luego una clase [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) para el contenido que se va a reproducir.
2. Regístrate para el evento [**MediaPlaybackItem.TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce a medida que la canalización multimedia resuelva las pistas secundarias del elemento multimedia.
3. Regístrate para los eventos [**TimedMetadataTrack.CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**TimedMetadataTrack.CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited) de las pistas de metadatos temporizados que quieras usar.
4. En el controlador de eventos **CueEntered**, actualiza la interfaz de usuario en función de los metadatos pasados en los argumentos de evento. Puedes volver a actualizar la interfaz de usuario para quitar el texto de subtítulo actual, por ejemplo, en el evento **CueExited**.

En este artículo, el control de cada tipo de metadatos se muestra como un escenario distintivo, pero es posible controlar, o pasar por alto, distintos tipos de metadatos con código principalmente compartido. Puedes comprobar la propiedad [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) del objeto [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) en varios puntos del proceso. Entonces, por ejemplo, podrías elegir registrarte para el evento **CueEntered** para pistas de metadatos que tengan el valor **TimedMetadataKind.ImageSubtitle**, pero no para pistas que tengan el valor **TimedMetadataKind.Speech**. O bien, en su lugar, podrías registrar un controlador para todos los tipos de pista de metadatos y luego comprobar el valor **TimedMetadataKind** del controlador **CueEntered** para determinar qué medida tomar en respuesta a la indicación.

## <a name="image-based-subtitles"></a>Subtítulos basados en imágenes
A partir de Windows 10, versión 1703, las aplicaciones para UWP pueden admitir subtítulos basados en imágenes externos en formato VobSub. Para usar esta característica, en primer lugar, crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) para el contenido multimedia para el que se mostrarán subtítulos basados en imagen. Luego, crea un objeto [**TimedTextSource**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource). Para ello, llama a [**CreateFromUriWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromUriWithIndex) o [**CreateFromStreamWithIndex**](https://docs.microsoft.com/uwp/api/windows.media.core.timedtextsource.CreateFromStreamWithIndex) y pasa el URI del archivo .sub que contiene los datos de imagen de subtítulo y el archivo .idx que contiene la información de temporización de los subtítulos. Agrega el objeto **TimedTextSource** a la clase **MediaSource**. Para ello, agrégala a la colección [**ExternalTimedTextSources**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.ExternalTimedTextSources) del origen. Crea un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir de la clase **MediaSource**.

[!code-cs[ImageSubtitleLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleLoadContent)]

Regístrate para los eventos de metadatos de subtítulo de imagen mediante el objeto **MediaPlaybackItem** que se creó en el paso anterior. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForImageSubtitles**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**. En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForImageSubtitles**.

[!code-cs[ImageSubtitleTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleTracksChanged)]

Después de registrarse para los eventos de metadatos de subtítulo de imagen, el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ImageSubtitlePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitlePlay)]

En el método auxiliar **RegisterMetadataHandlerForImageSubtitles**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) de la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.

[!code-cs[RegisterMetadataHandlerForImageSubtitles](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForImageSubtitles)]

En el controlador del evento **CueEntered**, puedes comprobar la propiedad [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) del objeto [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) que se pasa al controlador para ver si los metadatos son para los subtítulos de imagen. Esto es necesario si usas el mismo controlador de eventos de indicación de datos para varios tipos de metadatos. Si la pista de metadatos asociada es de tipo **TimedMetadataKind.ImageSubtitle**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**ImageCue**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue). La propiedad [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.SoftwareBitmap) del objeto **ImageCue** contiene una representación [**SoftwareBitmap**](https://docs.microsoft.com/uwp/api/windows.graphics.imaging.softwarebitmap) de la imagen de subtítulo. Crea un objeto [**SoftwareBitmapSource**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource) y llama a [**SetBitmapAsync**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.media.imaging.softwarebitmapsource.SetBitmapAsync) para asignar la imagen a un control XAML [**Image**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.image). Las propiedades [**Extent**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Extent) y [**Position**](https://docs.microsoft.com/uwp/api/windows.media.core.imagecue.Position) del objeto **ImageCue** proporcionan información sobre el tamaño y la posición de la imagen de subtítulo.

[!code-cs[ImageSubtitleCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetImageSubtitleCueEntered)]

## <a name="speech-cues"></a>Indicaciones de voz
A partir de Windows 10, versión 1703, las aplicaciones para UWP pueden registrarse para recibir eventos en respuesta a límites de palabras, límites de oración y marcadores de Lenguaje de marcado de síntesis de voz (SSML) en contenido multimedia reproducido. De este modo, se pueden reproducir secuencias de audio generadas mediante la clase [**SpeechSynthesizer**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer) y actualizar la interfaz de usuario en función de estos eventos, como mostrar el texto de la palabra o frase en reproducción.

En el ejemplo que se muestra en esta sección se usa una variable de miembro de clase para almacenar una cadena de texto que se sintetizará y reproducirá.

[!code-cs[SpeechInputText](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechInputText)]

Crea una nueva instancia de la clase **SpeechSynthesizer**. Establece las opciones [**IncludeWordBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeWordBoundaryMetadata) y [**IncludeSentenceBoundaryMetadata**](https://docs.microsoft.com/uwp/api/windows.media.speechsynthesis.speechsynthesizeroptions.IncludeSentenceBoundaryMetadata) del sintetizador en **true** para especificar que los metadatos se deben incluir en la secuencia multimedia generada. Llama a [**SynthesizeTextToStreamAsync**](https://docs.microsoft.com/uwp/api/Windows.Media.SpeechSynthesis.SpeechSynthesizer.SynthesizeTextToStreamAsync) para generar una secuencia que contenga la voz sintetizada y los metadatos correspondientes. Crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) y un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir de la secuencia sintetizada.

[!code-cs[SynthesizeSpeech](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSynthesizeSpeech)]

Regístrate para los eventos de metadatos de voz mediante el objeto **MediaPlaybackItem**. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForSpeech**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**.  En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForSpeech**.

[!code-cs[SpeechTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechTracksChanged)]

Después de registrarse para los eventos de metadatos de voz, el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[SpeechPlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechPlay)]

En el método auxiliar **RegisterMetadataHandlerForSpeech**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) de la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.

[!code-cs[RegisterMetadataHandlerForWords](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForWords)]

En el controlador del evento **CueEntered**, puedes comprobar la propiedad [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) del objeto [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) que se pasa al controlador para ver si los metadatos corresponden a tipos de voz. Esto es necesario si usas el mismo controlador de eventos de indicación de datos para varios tipos de metadatos. Si la pista de metadatos asociada es de tipo **TimedMetadataKind.Speech**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**SpeechCue**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue). Para las indicaciones de voz, el tipo de indicación de voz que se incluye en la pista de metadatos se determina al comprobar la propiedad **Label**. El valor de esta propiedad será "SpeechWord" para los límites de palabras, "SpeechSentence" para los límites de oración o "SpeechBookmark" marcadores SSML. En este ejemplo, comprobamos si existe el valor "SpeechWord" y, si se encuentra, se usan las propiedades [**StartPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.StartPositionInInput) y [**EndPositionInInput**](https://docs.microsoft.com/uwp/api/windows.media.core.speechcue.EndPositionInInput) del objeto **SpeechCue** para determinar la ubicación en el texto de entrada de la palabra en reproducción. En este ejemplo, cada palabra se transmite en el resultado de depuración.

[!code-cs[SpeechWordCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetSpeechWordCueEntered)]

## <a name="chapter-cues"></a>Indicaciones de capítulo
A partir de Windows 10, versión 1703, las aplicaciones para UWP se pueden registrar para indicaciones que corresponden a los capítulos dentro de un elemento multimedia. Para usar esta característica, crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource) para el contenido multimedia y luego crea un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir del objeto **MediaSource**.

[!code-cs[ChapterCueLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueLoadContent)]

Regístrate para los eventos de metadatos de capítulo mediante el objeto **MediaPlaybackItem** que se creó en el paso anterior. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForChapterCues**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**. En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForChapterCues**.

[!code-cs[ChapterCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueTracksChanged)]

Después de registrarse para los eventos de metadatos de capítulo, el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ChapterCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCuePlay)]

En el método auxiliar **RegisterMetadataHandlerForChapterCues**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) de la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.

[!code-cs[RegisterMetadataHandlerForChapterCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForChapterCues)]

En el controlador del evento **CueEntered**, puedes comprobar la propiedad [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) del objeto [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) que se pasa al controlador para ver si los metadatos son para las indicaciones de capítulo. Esto es necesario si usas el mismo controlador de eventos de indicación de datos para varios tipos de metadatos. Si la pista de metadatos asociada es de tipo **TimedMetadataKind.Chapter**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**ChapterCue**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue). La propiedad [**Title**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.Title) del objeto **ChapterCue** contiene el título del capítulo que se acaba de alcanzar en la reproducción.

[!code-cs[ChapterCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetChapterCueEntered)]

### <a name="seek-to-the-next-chapter-using-chapter-cues"></a>Hacer una búsqueda hasta el siguiente capítulo mediante indicaciones de capítulo
Además de recibir notificaciones cuando cambia el capítulo actual en un elemento en reproducción, también puedes usar indicaciones de capítulo para buscar el capítulo siguiente dentro de un elemento en reproducción. En el método de ejemplo que se muestra a continuación se toma como argumentos un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) y un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) que representan el elemento multimedia en reproducción. Se busca en la colección [**TimedMetadataTracks**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracks) para ver si hay pistas con la propiedad [**TimedMetadataKind**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.TimedMetadataKind) del valor [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) de **TimedMetadataKind.Chapter**.  Si se encuentra una pista de capítulo, el método repite por cada indicación en la colección [**Cues**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.Cues) de la pista para buscar la primera indicación con un valor [**StartTime**](https://docs.microsoft.com/uwp/api/windows.media.core.chaptercue.StartTime) superior al objeto [**Position**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacksession.Position) actual de la sesión de reproducción del reproductor multimedia. Cuando se encuentre la indicación correcta, se actualiza la posición de la sesión de reproducción y se actualiza el título de capítulo en la interfaz de usuario.

[!code-cs[GoToNextChapter](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetGoToNextChapter)]

## <a name="extended-m3u-comments"></a>Comentarios M3U extendidos
A partir de Windows 10, versión 1703, las aplicaciones para UWP pueden registrarse para indicaciones que corresponden a los comentarios dentro de un archivo de manifiesto M3U extendido. En este ejemplo, se usa el objeto [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) para reproducir el contenido multimedia. Para obtener más información, consulta [Streaming adaptable](adaptive-streaming.md). Crea un objeto **AdaptiveMediaSource** para el contenido. Para ello, llamada a [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) o [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource). Para ello, llama a [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) y luego crea un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir del objeto **MediaSource**.

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

Regístrate para los eventos de metadatos de M3U mediante el objeto **MediaPlaybackItem** que se creó en el paso anterior. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForEXTM3UCues**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**. En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForEXTM3UCues**.

[!code-cs[EXTM3UCueTracksChanged](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueTracksChanged)]

Después de registrarse para los eventos de metadatos de M3U, el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[EXTM3UCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCuePlay)]

En el método auxiliar **RegisterMetadataHandlerForEXTM3UCues**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Comprueba la propiedad DispatchType de la pista de metadatos, que tendrá un valor de "EXTM3U" si la pista representa comentarios M3U. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) en la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.

[!code-cs[RegisterMetadataHandlerForEXTM3UCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEXTM3UCues)]

En el controlador del evento **CueEntered**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Comprueba que las propiedades **DataCue** y [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) de la indicación no son nulas. Los comentarios EMU extendidos se proporcionan en forma de cadenas UTF-16, little endian y finalizadas en nulo. Crea un nuevo objeto **DataReader** para leer los datos de referencia mediante una llamada a [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer). Establece la propiedad [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding) del lector en [**Utf16LE**](https://docs.microsoft.com/uwp/api/windows.storage.streams.unicodeencoding) para leer los datos en el formato correcto. Llama a [**ReadString**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.ReadString) para leer los datos, especificando la mitad de la longitud del campo **Datos**, ya que cada carácter tiene dos bytes de tamaño y se resta uno para quitar el carácter nulo final. En este ejemplo, el comentario M3U simplemente se escribe en el resultado de depuración.

[!code-cs[EXTM3UCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3UCueEntered)]

## <a name="id3-tags"></a>Etiquetas ID3
A partir de Windows 10, versión 1703, las aplicaciones para UWP pueden registrarse para obtener indicadores que corresponden a las etiquetas ID3 dentro del contenido HTTP Live Streaming (HLS). En este ejemplo, se usa el objeto [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) para reproducir el contenido multimedia. Para obtener más información, consulta [Streaming adaptable](adaptive-streaming.md). Crea un objeto **AdaptiveMediaSource** para el contenido. Para ello, llamada a [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) o [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource). Para ello, llama a [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) y luego crea un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir del objeto **MediaSource**.

[!code-cs[EXTM3ULoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEXTM3ULoadContent)]

Regístrate para los eventos de etiquetas ID3 mediante el objeto **MediaPlaybackItem** que se creó en el paso anterior. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForID3Cues**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**. En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForID3Cues**.

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

Después de registrarse para los eventos de metadatos de ID3 el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[ID3CuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CuePlay)]


En el método auxiliar **RegisterMetadataHandlerForID3Cues**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Comprueba la propiedad DispatchType de la pista de metadatos, que tendrá un valor que contiene la cadena GUID "15260DFFFF49443320FF49443320000F" si la pista representa etiquetas ID3. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) en la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.

[!code-cs[RegisterMetadataHandlerForID3Cues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForID3Cues)]

En el controlador del evento **CueEntered**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Comprueba que las propiedades **DataCue** y [**Data**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Data) de la indicación no son nulas. Los comentarios de UME extendidos se proporcionan en forma de bytes sin procesar en la emisión de transporte (consulta [http://id3.org/id3v2.4.0-structure](http://id3.org/id3v2.4.0-structure)). Crea un nuevo objeto **DataReader** para leer los datos de referencia mediante una llamada a [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer).  En este ejemplo, los valores de encabezado de la etiqueta ID3 se leen de los datos de indicación y se escriben en el resultado de depuración.

[!code-cs[ID3CueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3CueEntered)]

## <a name="fragmented-mp4-emsg-boxes"></a>Cuadros mp4 emsg fragmentados
A partir de Windows 10, versión 1703, las aplicaciones para UWP pueden registrarse en indicadores que corresponden a cuadros emsg dentro de las emisiones de archivo mp4 fragmentadas. Un ejemplo de uso de este tipo de metadatos es cuando los proveedores de contenido señalan a las aplicaciones de cliente que deben reproducir un anuncio durante el streaming en directo de contenido. En este ejemplo, se usa el objeto [**AdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource) para reproducir el contenido multimedia. Para obtener más información, consulta [Streaming adaptable](adaptive-streaming.md). Crea un objeto **AdaptiveMediaSource** para el contenido. Para ello, llamada a [**CreateFromUriAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromUriAsync) o [**CreateFromStreamAsync**](https://docs.microsoft.com/uwp/api/windows.media.streaming.adaptive.adaptivemediasource.CreateFromStreamAsync). Crea un objeto [**MediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource). Para ello, llama a [**CreateFromAdaptiveMediaSource**](https://docs.microsoft.com/uwp/api/windows.media.core.mediasource.CreateFromAdaptiveMediaSource) y luego crea un objeto [**MediaPlaybackItem**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem) a partir del objeto **MediaSource**.

[!code-cs[EmsgLoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgLoadContent)]

Regístrate para los eventos de cuadro de emsg mediante el objeto **MediaPlaybackItem** que se creó en el paso anterior. En este ejemplo se usa un método auxiliar, **RegisterMetadataHandlerForEmsgCues**, para registrarse para los eventos. Se usa una expresión lambda para implementar un controlador para el evento [**TimedMetadataTracksChanged**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybackitem.TimedMetadataTracksChanged), que se produce cuando el sistema detecta un cambio en las pistas de metadatos asociadas con un objeto **MediaPlaybackItem**. En algunos casos, las pistas de metadatos podrían estar disponibles cuando se resuelve inicialmente el elemento de reproducción, por lo que, fuera del controlador **TimedMetadataTracksChanged**, también repetimos las pistas de metadatos disponibles y llamamos a **RegisterMetadataHandlerForEmsgCues**.

[!code-cs[ID3LoadContent](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetID3LoadContent)]

Después de registrarse para los eventos de cuadro emsg, el objeto **MediaItem** se asigna a un objeto [**MediaPlayer**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplayer) para la reproducción dentro de un objeto [**MediaPlayerElement**](https://docs.microsoft.com/uwp/api/windows.ui.xaml.controls.mediaplayerelement).

[!code-cs[EmsgCuePlay](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCuePlay)]


En el método auxiliar **RegisterMetadataHandlerForEmsgCues**, obtén una instancia de la clase [**TimedMetadataTrack**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack) mediante la indexación en la colección **TimedMetadataTracks** del objeto **MediaPlaybackItem**. Comprueba la propiedad DispatchType de la pista de metadatos, que tendrá un valor de "emsg:mp4" si la pista representa cuadros emsg. Regístrate para los eventos [**CueEntered**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueEntered) y [**CueExited**](https://docs.microsoft.com/uwp/api/windows.media.core.timedmetadatatrack.CueExited). Luego, tienes que llamar al objeto [**SetPresentationMode**](https://docs.microsoft.com/uwp/api/windows.media.playback.mediaplaybacktimedmetadatatracklist.SetPresentationMode) en la colección **TimedMetadataTracks** del elemento de reproducción para indicar al sistema que la aplicación quiere recibir eventos de indicación de metadatos para este elemento de reproducción.


[!code-cs[RegisterMetadataHandlerForEmsgCues](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetRegisterMetadataHandlerForEmsgCues)]


En el controlador del evento **CueEntered**, transmite la indicación de datos incluida en la propiedad **Cue** del objeto [**MediaCueEventArgs**](https://docs.microsoft.com/uwp/api/windows.media.core.mediacueeventargs) a un objeto [**DataCue**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue).  Comprueba que el objeto **DataCue** no es nulo. Las propiedades del cuadro emsg las proporciona la canalización multimedia como propiedades personalizadas en la colección [**Properties**](https://docs.microsoft.com/uwp/api/windows.media.core.datacue.Properties) del objeto DataCue. En este ejemplo se intenta extraer varios valores de propiedad diferentes mediante el método **[TryGetValue](https://docs.microsoft.com/uwp/api/windows.foundation.collections.propertyset.trygetvalue)**. Si este método devuelve nulo, significa que la propiedad solicitada no está presente en el cuadro emsg, de modo que se establece un valor predeterminado en su lugar.

En la parte siguiente del ejemplo se muestra el escenario donde se desencadena la reproducción de anuncios, lo que sucede cuando la propiedad *scheme_id_uri*, obtenida en el paso anterior, tiene un valor de "urn: scte:scte35:2013:xml" (consulta [http://dashif.org/identifiers/event-schemes/](http://dashif.org/identifiers/event-schemes/)). Ten en cuenta que, según el estándar, se recomienda enviar este emsg varias veces para la redundancia, de modo que en este ejemplo se mantiene una lista de identificadores emsg que ya se han procesado y se procesan solo los mensajes nuevos. Crea un nuevo objeto **DataReader** para leer los datos de indicación mediante una llamada a [**DataReader.FromBuffer**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.FromBuffer) y establece la codificación en UTF-8 estableciendo la propiedad [**UnicodeEncoding**](https://docs.microsoft.com/uwp/api/windows.storage.streams.datareader.UnicodeEncoding). Luego, lee los datos. En este ejemplo, la carga del mensaje se escribe en el resultado de depuración. Una aplicación real sería usar los datos de carga para programar la reproducción de un anuncio.

[!code-cs[EmsgCueEntered](./code/MediaSource_RS1/cs/MainPage_Cues.xaml.cs#SnippetEmsgCueEntered)]


## <a name="related-topics"></a>Temas relacionados

* [Reproducción de contenido multimedia](media-playback.md)
* [Elementos multimedia, listas de reproducción y pistas](media-playback-with-mediasource.md)


 




